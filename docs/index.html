<!DOCTYPE html>
<html>
  <head>
    <title>FUEL Map</title>
    <link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="manifest" href="site.webmanifest" />
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#0077ee" />
    <meta name="msapplication-TileColor" content="#0077ee" />
    <meta name="theme-color" content="#000000" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/js-polyfills/0.1.43/polyfill.min.js"
      integrity="sha512-lvWiOP+aMKHllm4THsjzNleVuGOh0WGniJ3lgu/nvCbex1LlaQSxySUjAu/LTJw9FhnSL/PVYoQcckg1Q03+fQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/ol3/4.6.5/ol.js"
      integrity="sha512-O7kHS9ooekX8EveiC94z9xSvD/4xt10Qigl6uEKvspYykdux3Ci5QNu5fwi4ca0ZkZI/oCgx5ja8RklWUEqzxQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/ol3/4.6.5/ol.css"
      integrity="sha512-D2c/nmSVlwoZk29SLwJK8GkLyCyPuNbZ/vZQL/lNzw+o+yXzsbnJt7lK/iCfdBmgyLRDi0qx27gpE8Zb1C6I7g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.min.css"
    />
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const extent = [-70000.0, -70000.0, 70000.0, 70000.0];
        const projection = new ol.proj.Projection({
          code: "CUSTOM:FUEL",
          units: "pixels",
          extent: extent,
          axisOrientation: "neu",
          global: true,
          metersPerUnit: 1,
        });

        ol.proj.addCoordinateTransforms(
          "EPSG:4326",
          projection,
          function (coordinate) {
            return [coordinate[0], -coordinate[1]];
          },
          function (coordinate) {
            return [coordinate[0], -coordinate[1]];
          }
        );

        function style(feature) {
          return {
            Point: new ol.style.Style({
              image: new ol.style.Icon({
                src: `img/${feature.get("category")}.png`,
                scale: 0.25,
              }),
            }),
            LineString: new ol.style.Style({
              stroke: new ol.style.Stroke({
                color: "green",
                width: 4,
              }),
            }),
            Polygon: new ol.style.Style({
              fill: new ol.style.Fill({
                color: {
                  waterbody: [0, 0, 256, 256],
                  pool: [173, 216, 230, 256],
                }[feature.get("category")],
              }),
            }),
          }[feature.getGeometry().getType()];
        }

        const map = new ol.Map({
          target: "map",
          layers: [
            new ol.layer.Tile({
              source: new ol.source.TileImage({
                attributions: [
                  new ol.Attribution({
                    html: "This map uses imagery, data, and icons extracted from 'Fuel'™ (© 2008 The Codemasters Software Company Limited ('Codemasters')). All rights reserved. 'Codemasters'® is a registered trademark owned by Codemasters. 'Fuel'™ was developed by Asobo Studio S.a.r.l. and published by Codemasters. All trademarks and copyrights are the property of their respective owners. This project is non-commercial and is not affiliated with, endorsed by, or sponsored by Codemasters or Asobo Studio S.a.r.l.",
                  }),
                ],
              }),
            }),
            new ol.layer.Tile({
              title: "Map",
              visible: true,
              source: new ol.source.XYZ({
                url: "tile/{z}/{x}/{y}.png",
                maxZoom: 5,
                tileSize: 256,
                wrapX: false,
                projection: projection,
              }),
            }),
            new ol.layer.Group({
              title: "Water",
              visible: false,
              layers: [
                new ol.layer.Vector({
                  title: "Waterbody",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/waterbody.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
                new ol.layer.Vector({
                  title: "Pool",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/pool.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
              ],
            }),
            new ol.layer.Group({
              title: "Roads",
              visible: false,
              layers: [
                new ol.layer.Vector({
                  title: "Roads",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/road.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
              ],
            }),
            new ol.layer.Group({
              title: "Points of Interest",
              layers: [
                new ol.layer.Vector({
                  title: "Heliports",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/teleport.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
                new ol.layer.Vector({
                  title: "Vista Points",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/vp.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
                new ol.layer.Vector({
                  title: "Liveries",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/livery.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
                new ol.layer.Vector({
                  title: "Camps",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/hub.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
              ],
            }),
            new ol.layer.Group({
              title: "Races",
              layers: [
                new ol.layer.Vector({
                  title: "Indian Races",
                  visible: false,
                  source: new ol.source.Vector({
                    url: "geo/indian.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
                new ol.layer.Vector({
                  title: "Hidden Races",
                  visible: false,
                  source: new ol.source.Vector({
                    url: "geo/hidden.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
                new ol.layer.Vector({
                  title: "Challenge Races",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/challenge.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
                new ol.layer.Vector({
                  title: "Career Races",
                  visible: true,
                  source: new ol.source.Vector({
                    url: "geo/career.geojson",
                    format: new ol.format.GeoJSON({
                      dataProjection: projection,
                    }),
                    wrapX: false,
                    projection: projection,
                  }),
                  style: style,
                }),
              ],
            }),
          ],
          view: new ol.View({
            center: [0, 0],
            zoom: 2,
            minZoom: 0,
            maxZoom: 10,
            projection: projection,
            extent: extent,
          }),
        });

        const layerSwitcher = new LayerSwitcher({
          reverse: true,
          groupSelectStyle: "group",
        });
        map.addControl(layerSwitcher);

        map.on("click", function (event) {
          var point = map.getCoordinateFromPixel(event.pixel);
          console.log([point[0], -point[1]]);
        });
      });
    </script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        background-color: black;
      }

      #map {
        height: 100%;
        width: 100%;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
