<!DOCTYPE html>
<html>
  <head>
    <title>FUEL Map</title>
    <link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="manifest" href="site.webmanifest" />
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#0077ee" />
    <meta name="msapplication-TileColor" content="#0077ee" />
    <meta name="theme-color" content="#000000" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/js-polyfills/0.1.43/polyfill.min.js"
      integrity="sha512-lvWiOP+aMKHllm4THsjzNleVuGOh0WGniJ3lgu/nvCbex1LlaQSxySUjAu/LTJw9FhnSL/PVYoQcckg1Q03+fQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openlayers/10.6.1/dist/ol.min.js"
      integrity="sha512-NEUbbO7KI1OYn+IHcF70vm3ON0obczJz9PJFwxHkfPCsT14UqDD4roG7rF5WpwkXRTPvysFb6Wvw/Tjh5tfv8g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/openlayers/10.6.1/ol.min.css"
      integrity="sha512-oVyisN6T8O7H9DnBc1w/IipxzLhNvJERKa0Rx9fKEtaodE7UXQAypIHamYzQPAqVxp0pVl25e4spVQWIVfu6eA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.min.css"
    />
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const extent = [-70000.0, -70000.0, 70000.0, 70000.0];
        const metersPerUnit = 1;
        const dataProjection = new ol.proj.Projection({
          code: "CUSTOM:FUEL_DATA_PROJECTION",
          units: "m",
          extent: extent,
          axisOrientation: "seu",
          global: true,
          metersPerUnit: metersPerUnit,
        });

        ol.proj.setUserProjection(dataProjection);

        const viewProjection = new ol.proj.Projection({
          code: "CUSTOM:FUEL_VIEW_PROJECTION",
          units: "m",
          extent: extent,
          axisOrientation: "neu",
          global: true,
          metersPerUnit: metersPerUnit,
        });

        ol.proj.addCoordinateTransforms(
          dataProjection,
          viewProjection,
          function (coordinate) {
            return [coordinate[0], -coordinate[1]];
          },
          function (coordinate) {
            return [coordinate[0], -coordinate[1]];
          }
        );

        function createGeoJSONVectorImageLayer(
          title,
          basename,
          style,
          visible = true,
          minZoom = undefined
        ) {
          return new ol.layer.VectorImage({
            title: title,
            visible: visible,
            minZoom: minZoom,
            source: new ol.source.Vector({
              url: `geo/${basename}.geojson`,
              format: new ol.format.GeoJSON({
                dataProjection: dataProjection,
              }),
              wrapX: false,
              projection: dataProjection,
              overlaps: false,
            }),
            style: style,
          });
        }

        function createGeoJSONVectorLayer(
          title,
          basename,
          style,
          visible = true,
          minZoom = undefined
        ) {
          return new ol.layer.Vector({
            title: title,
            visible: visible,
            minZoom: minZoom,
            source: new ol.source.Vector({
              url: `geo/${basename}.geojson`,
              format: new ol.format.GeoJSON({
                dataProjection: dataProjection,
              }),
              wrapX: false,
              projection: dataProjection,
              overlaps: false,
            }),
            style: style,
          });
        }

        function createGeoJSONVectorLayerIcon(title, basename, visible = true) {
          return createGeoJSONVectorLayer(
            title,
            basename,
            {
              "icon-src": `img/${basename}.png`,
              "icon-width": 35,
            },
            visible
          );
        }

        const thin_trail_style = {
          "stroke-color": [199, 93, 57, 255],
          "stroke-width": 1,
        };

        const trail_style = {
          "stroke-color": [199, 93, 57, 255],
          "stroke-width": 2,
        };

        const road_style_color = [206, 207, 206, 255];
        const road_style = {
          "stroke-color": road_style_color,
          "stroke-width": 3,
        };

        const highway_style = {
          "stroke-color": road_style_color,
          "stroke-width": 5,
        };

        const shortcut_style = {
          "stroke-color": [128, 128, 128, 128],
          "stroke-width": 3,
        };

        const map = new ol.Map({
          target: "map",
          layers: [
            new ol.layer.Tile({
              source: new ol.source.TileImage({
                attributions:
                  "This map uses imagery, data, and icons extracted from 'Fuel'™ (© 2008 The Codemasters Software Company Limited ('Codemasters')). All rights reserved. 'Codemasters'® is a registered trademark owned by Codemasters. 'Fuel'™ was developed by Asobo Studio S.a.r.l. and published by Codemasters. All trademarks and copyrights are the property of their respective owners. This project is non-commercial and is not affiliated with, endorsed by, or sponsored by Codemasters or Asobo Studio S.a.r.l.",
              }),
            }),
            new ol.layer.Tile({
              title: "Map",
              visible: true,
              source: new ol.source.XYZ({
                url: "tile/{z}/{x}/{y}.png",
                maxZoom: 5,
                tileSize: 256,
                wrapX: false,
                projection: viewProjection,
              }),
            }),
            new ol.layer.Group({
              title: "Water",
              layers: [
                createGeoJSONVectorLayer(
                  "Waterbodies",
                  "waterbody",
                  { "fill-color": [0, 0, 255, 255] },
                  false
                ),
                createGeoJSONVectorLayer(
                  "Pools",
                  "pool",
                  { "fill-color": [173, 216, 230, 255] },
                  false
                ),
                createGeoJSONVectorImageLayer(
                  "Rivers",
                  "river",
                  {
                    "stroke-color": [58, 97, 131, 255],
                    "stroke-width": 2,
                  },
                  true,
                  5
                ),
              ],
            }),
            new ol.layer.Group({
              title: "Roads",
              layers: [
                new ol.layer.Group({
                  title: "Shortcuts",
                  minZoom: 5,
                  layers: [
                    createGeoJSONVectorImageLayer(
                      "Shortcut Short",
                      "shortcutshort",
                      shortcut_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Shortcut Long",
                      "shortcutlong",
                      shortcut_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Shortcut Field",
                      "shortcutfield",
                      shortcut_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Shortcut Forest",
                      "shortcutforest",
                      shortcut_style
                    ),
                  ],
                }),
                new ol.layer.Group({
                  title: "Small Dirt Roads",
                  minZoom: 5,
                  layers: [
                    createGeoJSONVectorImageLayer(
                      "Thin Dirt Road",
                      "snowydirtroad",
                      thin_trail_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Tiny Dirt Road",
                      "fieldroad",
                      thin_trail_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Steep Double Wide Dirt Road",
                      "saltroad",
                      trail_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Goat Path",
                      "goatpath",
                      trail_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Double Wide Dirt Road",
                      "bigtarmacroad",
                      road_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Circuit Track",
                      "circuittrack",
                      road_style
                    ),
                  ],
                }),
                new ol.layer.Group({
                  title: "Big Dirt Roads",
                  minZoom: 4,
                  layers: [
                    createGeoJSONVectorImageLayer(
                      "Normal Dirt Road",
                      "normaldirtroad",
                      trail_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Big Dirt Road",
                      "smalldirtroad",
                      trail_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Another Big Dirt Road",
                      "bigdirtroad",
                      trail_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Small Tarmac Road",
                      "smalltarmacroad",
                      road_style
                    ),
                  ],
                }),
                new ol.layer.Group({
                  title: "Major Roads",
                  minZoom: 2,
                  layers: [
                    createGeoJSONVectorImageLayer(
                      "Alternate Paved Route",
                      "smallcircuittrack",
                      road_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Normal Tarmac Road",
                      "normaltarmacroad",
                      road_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Bridges",
                      "bridge",
                      road_style
                    ),
                    createGeoJSONVectorImageLayer(
                      "Highways",
                      "highway",
                      highway_style
                    ),
                  ],
                }),
              ],
            }),
            createGeoJSONVectorLayer("Zones", "zone", {
              "stroke-color": [0, 0, 0, 255],
              "stroke-width": 3,
            }),
            new ol.layer.Group({
              title: "Points of Interest",
              layers: [
                createGeoJSONVectorLayerIcon("Heliports", "teleport"),
                createGeoJSONVectorLayerIcon("Vista Points", "vp"),
                createGeoJSONVectorLayerIcon("Liveries", "livery"),
                createGeoJSONVectorLayerIcon("Camps", "hub"),
              ],
            }),
            new ol.layer.Group({
              title: "Races",
              layers: [
                createGeoJSONVectorLayerIcon("Indian Races", "indian", false),
                createGeoJSONVectorLayerIcon("Hidden Races", "hidden", false),
                createGeoJSONVectorLayerIcon("Challenge Races", "challenge"),
                createGeoJSONVectorLayerIcon("Career Races", "career"),
              ],
            }),
          ],
          view: new ol.View({
            center: ol.extent.getCenter(extent),
            zoom: 2,
            minZoom: 0,
            maxZoom: 10,
            projection: viewProjection,
            extent: extent,
            constrainOnlyCenter: true,
          }),
        });

        const layerSwitcher = new LayerSwitcher({
          reverse: true,
          groupSelectStyle: "group",
        });
        map.addControl(layerSwitcher);

        map.on("click", function (event) {
          var point = map.getCoordinateFromPixel(event.pixel);
          console.log(point);
        });
      });
    </script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        background-color: black;
      }

      #map {
        height: 100%;
        width: 100%;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
